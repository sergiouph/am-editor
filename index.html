<!DOCTYPE html>
<head>
  <title>State Machine Diagram</title>
  <style type="text/css">
    #layout {
      display: flex;
    }
    #input {
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div id="layout">
    <div>
      <textarea id="input" cols="30" rows="50" name="input" onchange="refresh()">
I S1 ! A
A S3
S S2 ! B
T S1 -> S2 : a ! C
T S2 -> S3 : b</textarea>
    </div>
    <div id="output"></div>
  </div>

  <script src="machine-engine.js"></script>
  <script src="machine-parser.js"></script>
  <script src="machine-formatter.js"></script>
  <script src="node_modules/viz.js/viz.js"></script>
  <script src="node_modules/viz.js/full.render.js"></script>
  <script>
    refresh()

    function refresh() {
      const input = document.getElementById('input').value
      const machine = parseMachine(input)
      console.log(machine)
      const code = generateVizCode(machine);
      const viz = new Viz();

      console.log(code)

      viz
        .renderSVGElement(code)
        .then(function (element) {
          const container = document.getElementById('output')
          while (container.firstChild) {
            container.removeChild(container.lastChild)
          }
          container.appendChild(element)
        })
        .catch((error) => console.error(error));
    }
  </script>
</body>
